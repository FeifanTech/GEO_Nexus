# GEO Nexus - Phase 2 产品需求文档

> 版本: 1.0  
> 状态: 规划中  
> 创建日期: 2026-01-26  
> 最后更新: 2026-01-26

---

## 📋 文档概述

本文档描述 GEO Nexus 平台第二阶段的产品需求规划，基于第一阶段已完成功能的基础上，进一步增强平台的企业级能力。

### 第一阶段回顾

| 模块 | 状态 | 完成度 |
|------|------|--------|
| 工作台 Dashboard | ✅ 已完成 | 100% |
| 产品管理 | ✅ 已完成 | 100% |
| 竞品管理 | ✅ 已完成 | 100% |
| GEO 诊断 | ✅ 已完成 | 100% |
| 内容工厂 | ✅ 已完成 | 100% |
| 作业流管理 | ✅ 已完成 | 100% |
| 问题库 | ✅ 已完成 | 100% |
| AI 排名监测 | ✅ 已完成 | 90% |
| 监测报告 | ✅ 已完成 | 100% |
| 系统设置 | ✅ 已完成 | 100% |
| 用户体验优化 | ✅ 已完成 | 100% |

---

## 🎯 第二阶段目标

### 核心目标

1. **企业级数据存储** - 从 LocalStorage 迁移到服务端数据库
2. **用户认证系统** - 支持多用户、团队协作
3. **定时监测能力** - 自动化监测任务调度
4. **数据分析增强** - 高级图表、趋势预测
5. **API 开放平台** - 支持第三方系统集成

### 成功指标

| 指标 | 目标值 | 说明 |
|------|--------|------|
| 数据存储容量 | 无限制 | 取消 LocalStorage 5MB 限制 |
| 并发用户数 | 100+ | 支持多用户同时使用 |
| 监测任务数 | 1000+/天 | 支持大规模定时监测 |
| API 响应时间 | <500ms | 95% 请求在 500ms 内响应 |
| 系统可用性 | 99.5% | 服务级别目标 |

---

## 📦 功能模块详述

### 1. 用户认证与多租户系统

**优先级**: P1  
**预计工期**: 5 天

#### 1.1 功能描述

实现完整的用户认证系统，支持多用户注册、登录，以及团队协作功能。

#### 1.2 用户故事

| ID | 角色 | 需求 | 目的 |
|----|------|------|------|
| US-1.1 | 新用户 | 我想用邮箱注册账号 | 开始使用平台 |
| US-1.2 | 用户 | 我想用密码/第三方登录 | 安全便捷地访问 |
| US-1.3 | 团队管理员 | 我想邀请成员加入团队 | 协作管理产品 |
| US-1.4 | 团队成员 | 我想看到团队共享的数据 | 协同工作 |
| US-1.5 | 管理员 | 我想设置成员权限 | 控制数据访问 |

#### 1.3 功能需求

**认证方式**
- [ ] 邮箱 + 密码注册/登录
- [ ] 第三方登录 (Google, GitHub)
- [ ] 邮箱验证码登录
- [ ] 忘记密码/重置密码

**用户管理**
- [ ] 用户个人资料设置
- [ ] 头像上传
- [ ] 密码修改
- [ ] 账号注销

**团队功能**
- [ ] 创建/管理团队
- [ ] 邀请链接/邮件邀请
- [ ] 成员角色 (管理员/编辑者/查看者)
- [ ] 团队数据隔离

#### 1.4 技术方案

```
认证方案: NextAuth.js v5
数据库: PostgreSQL + Prisma ORM
会话管理: JWT + Secure Cookie
```

#### 1.5 数据模型

```typescript
// 用户模型
interface User {
  id: string;
  email: string;
  name: string;
  avatar?: string;
  passwordHash?: string;
  emailVerified: boolean;
  createdAt: Date;
  updatedAt: Date;
}

// 团队模型
interface Team {
  id: string;
  name: string;
  slug: string;
  ownerId: string;
  createdAt: Date;
}

// 团队成员
interface TeamMember {
  id: string;
  userId: string;
  teamId: string;
  role: 'admin' | 'editor' | 'viewer';
  joinedAt: Date;
}
```

---

### 2. 服务端数据存储

**优先级**: P1  
**预计工期**: 3 天

#### 2.1 功能描述

将所有数据从 LocalStorage 迁移到 PostgreSQL 数据库，支持大容量存储和多设备同步。

#### 2.2 用户故事

| ID | 角色 | 需求 | 目的 |
|----|------|------|------|
| US-2.1 | 用户 | 我的数据在换设备后还能访问 | 数据不丢失 |
| US-2.2 | 用户 | 我想存储大量产品和监测记录 | 不受容量限制 |
| US-2.3 | 用户 | 我想从旧数据迁移到新系统 | 平滑过渡 |

#### 2.3 数据迁移计划

| LocalStorage Key | 数据库表 | 迁移策略 |
|-----------------|----------|----------|
| geo-nexus-products | products | 自动迁移 |
| geo-nexus-competitors | competitors | 自动迁移 |
| geo-nexus-tasks | tasks | 自动迁移 |
| geo-nexus-queries | search_queries | 自动迁移 |
| geo-nexus-monitor | monitor_tasks | 自动迁移 |
| geo-nexus-diagnosis | diagnosis_records | 自动迁移 |
| geo-nexus-content | content_records | 自动迁移 |
| geo-nexus-settings | user_settings | 自动迁移 |

#### 2.4 技术方案

```
数据库: PostgreSQL 15+
ORM: Prisma
连接池: PgBouncer (可选)
备份: 每日自动备份
```

#### 2.5 API 端点设计

```
# 产品 API
GET    /api/products          - 获取产品列表
POST   /api/products          - 创建产品
GET    /api/products/:id      - 获取单个产品
PUT    /api/products/:id      - 更新产品
DELETE /api/products/:id      - 删除产品

# 竞品 API
GET    /api/competitors       - 获取竞品列表
POST   /api/competitors       - 创建竞品
...

# 其他实体类似
```

---

### 3. 定时监测任务

**优先级**: P1  
**预计工期**: 3 天

#### 3.1 功能描述

支持设置定时规则，自动执行 AI 搜索监测任务，并生成监测报告。

#### 3.2 用户故事

| ID | 角色 | 需求 | 目的 |
|----|------|------|------|
| US-3.1 | 用户 | 我想设置每天自动监测 | 无需手动执行 |
| US-3.2 | 用户 | 我想收到监测结果通知 | 及时了解变化 |
| US-3.3 | 用户 | 我想查看监测历史趋势 | 分析长期表现 |

#### 3.3 功能需求

**调度规则**
- [ ] 支持 Cron 表达式
- [ ] 预设规则 (每日/每周/每月)
- [ ] 指定执行时间
- [ ] 暂停/恢复调度

**通知功能**
- [ ] 邮件通知
- [ ] 企业微信/钉钉 Webhook
- [ ] 站内消息通知
- [ ] 异常告警

**结果管理**
- [ ] 历史记录查询
- [ ] 数据对比分析
- [ ] 自动生成周报/月报

#### 3.4 技术方案

**方案 A: Vercel Cron (推荐)**
```typescript
// vercel.json
{
  "crons": [{
    "path": "/api/cron/monitor",
    "schedule": "0 9 * * *"  // 每天早上9点
  }]
}
```

**方案 B: 外部调度服务**
```
使用 Upstash QStash 或 Trigger.dev
支持更灵活的调度规则
```

#### 3.5 数据模型

```typescript
// 调度任务
interface ScheduledTask {
  id: string;
  userId: string;
  taskType: 'monitor' | 'report';
  cronExpression: string;
  enabled: boolean;
  lastRunAt?: Date;
  nextRunAt: Date;
  config: Record<string, any>;
}

// 执行记录
interface TaskExecution {
  id: string;
  scheduledTaskId: string;
  status: 'pending' | 'running' | 'success' | 'failed';
  startedAt: Date;
  completedAt?: Date;
  result?: Record<string, any>;
  error?: string;
}
```

---

### 4. 数据分析增强

**优先级**: P2  
**预计工期**: 3 天

#### 4.1 功能描述

提供更丰富的数据可视化和分析能力，帮助用户洞察 GEO 表现趋势。

#### 4.2 用户故事

| ID | 角色 | 需求 | 目的 |
|----|------|------|------|
| US-4.1 | 用户 | 我想看到排名变化趋势 | 评估优化效果 |
| US-4.2 | 用户 | 我想对比不同模型的表现 | 制定优化策略 |
| US-4.3 | 用户 | 我想预测未来排名走势 | 提前规划 |

#### 4.3 功能需求

**图表增强**
- [ ] 多维度趋势图 (时间/模型/问题)
- [ ] 热力图展示
- [ ] 漏斗图分析
- [ ] 对比雷达图

**分析功能**
- [ ] 同比/环比分析
- [ ] 异常检测预警
- [ ] 趋势预测 (简单线性回归)
- [ ] 竞品对比分析

**报告导出**
- [ ] 自定义报告模板
- [ ] PPT 格式导出
- [ ] 定期报告订阅

#### 4.4 技术方案

```
图表库: Recharts + D3.js (复杂图表)
数据处理: 服务端聚合计算
导出: react-pdf / pptxgenjs
```

---

### 5. API 开放平台

**优先级**: P2  
**预计工期**: 2 天

#### 5.1 功能描述

提供 RESTful API 接口，支持第三方系统集成和数据同步。

#### 5.2 用户故事

| ID | 角色 | 需求 | 目的 |
|----|------|------|------|
| US-5.1 | 开发者 | 我想通过 API 获取监测数据 | 集成到内部系统 |
| US-5.2 | 开发者 | 我想通过 API 触发监测任务 | 自动化流程 |
| US-5.3 | 管理员 | 我想管理 API 密钥 | 控制访问权限 |

#### 5.3 功能需求

**API 管理**
- [ ] API Key 生成/吊销
- [ ] 调用配额管理
- [ ] 访问日志记录
- [ ] API 文档 (Swagger/OpenAPI)

**开放接口**
- [ ] 产品数据 CRUD
- [ ] 监测任务管理
- [ ] 监测结果查询
- [ ] 报告数据获取

**安全措施**
- [ ] API Key 认证
- [ ] 请求频率限制
- [ ] IP 白名单 (可选)
- [ ] 请求签名验证

#### 5.4 API 规范

```yaml
# OpenAPI 3.0 示例
openapi: 3.0.0
info:
  title: GEO Nexus API
  version: 1.0.0
  
paths:
  /api/v1/products:
    get:
      summary: 获取产品列表
      security:
        - apiKey: []
      responses:
        200:
          description: 成功
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Product'
```

---

## 🗓️ 实施路线图

### 第一迭代 (Week 1-2)

| 任务 | 负责人 | 状态 |
|------|--------|------|
| PostgreSQL + Prisma 集成 | - | 待开始 |
| 数据模型设计 | - | 待开始 |
| NextAuth.js 集成 | - | 待开始 |
| 用户注册/登录页面 | - | 待开始 |
| LocalStorage 迁移工具 | - | 待开始 |

### 第二迭代 (Week 3-4)

| 任务 | 负责人 | 状态 |
|------|--------|------|
| 团队功能实现 | - | 待开始 |
| CRUD API 端点 | - | 待开始 |
| 定时任务调度 | - | 待开始 |
| 通知系统 | - | 待开始 |

### 第三迭代 (Week 5-6)

| 任务 | 负责人 | 状态 |
|------|--------|------|
| 数据分析图表 | - | 待开始 |
| 报告模板 | - | 待开始 |
| API 开放平台 | - | 待开始 |
| 文档完善 | - | 待开始 |

---

## 📐 技术架构升级

### 升级后架构图

```
┌─────────────────────────────────────────────────────────────────────────┐
│                           客户端 (Client Layer)                          │
│  ┌───────────────────────────────────────────────────────────────────┐  │
│  │                    Next.js 14 (React 18)                          │  │
│  │  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐  │  │
│  │  │  认证页面   │ │  各功能模块  │ │  数据分析   │ │  API 文档   │  │  │
│  │  └─────────────┘ └─────────────┘ └─────────────┘ └─────────────┘  │  │
│  └───────────────────────────────────────────────────────────────────┘  │
│                                   │                                      │
│                          NextAuth.js (认证)                              │
│                                   │                                      │
│                           React Query (数据获取)                         │
└─────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                           服务端 (Server Layer)                          │
│  ┌───────────────────────────────────────────────────────────────────┐  │
│  │                    Next.js API Routes                              │  │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐               │  │
│  │  │  /api/auth  │  │ /api/v1/*   │  │  /api/dify  │               │  │
│  │  │  认证接口   │  │ 业务接口    │  │  AI 接口    │               │  │
│  │  └─────────────┘  └─────────────┘  └─────────────┘               │  │
│  └───────────────────────────────────────────────────────────────────┘  │
│                                   │                                      │
│                           Prisma ORM                                     │
└─────────────────────────────────────────────────────────────────────────┘
                                    │
          ┌─────────────────────────┼─────────────────────────┐
          ▼                         ▼                         ▼
┌─────────────────┐       ┌─────────────────┐       ┌─────────────────┐
│   PostgreSQL    │       │      Redis      │       │   Dify Cloud    │
│    (主数据库)    │       │    (缓存/队列)   │       │    (AI 服务)    │
└─────────────────┘       └─────────────────┘       └─────────────────┘
```

### 新增技术栈

| 技术 | 版本 | 用途 |
|------|------|------|
| **NextAuth.js** | 5.x | 用户认证 |
| **Prisma** | 5.x | 数据库 ORM |
| **PostgreSQL** | 15+ | 关系型数据库 |
| **Redis** | 7.x | 缓存/会话存储 |
| **React Query** | 5.x | 服务端状态管理 |
| **Zod** | 3.x | 数据校验 |

---

## 🔒 安全与合规

### 数据安全

| 措施 | 说明 |
|------|------|
| 传输加密 | 全站 HTTPS |
| 数据加密 | 敏感字段 AES 加密 |
| 密码存储 | bcrypt 哈希 |
| SQL 注入防护 | Prisma 参数化查询 |
| XSS 防护 | React 自动转义 + CSP |

### 访问控制

| 角色 | 权限 |
|------|------|
| 查看者 | 只读所有数据 |
| 编辑者 | 读写产品/竞品/任务 |
| 管理员 | 全部权限 + 用户管理 |
| 所有者 | 管理员权限 + 团队设置 |

### 合规要求

- [ ] GDPR 数据删除请求支持
- [ ] 数据导出功能
- [ ] 隐私政策页面
- [ ] Cookie 同意管理

---

## 📊 风险评估

| 风险 | 影响 | 概率 | 缓解措施 |
|------|------|------|----------|
| 数据迁移丢失 | 高 | 低 | 迁移前备份 + 双写验证 |
| 性能下降 | 中 | 中 | 数据库索引 + 缓存 |
| 认证漏洞 | 高 | 低 | 使用成熟库 + 安全审计 |
| 定时任务失败 | 中 | 中 | 重试机制 + 告警 |
| API 滥用 | 中 | 中 | 频率限制 + 监控 |

---

## 📝 验收标准

### 功能验收

- [ ] 用户可以注册、登录、退出
- [ ] 团队创建和成员邀请功能正常
- [ ] 所有数据正确存储到数据库
- [ ] LocalStorage 数据成功迁移
- [ ] 定时监测任务按时执行
- [ ] 监测结果通知正常发送
- [ ] API 接口文档完整准确
- [ ] API 调用认证和限流正常

### 性能验收

- [ ] 页面加载时间 < 3s
- [ ] API 响应时间 < 500ms (P95)
- [ ] 支持 100 并发用户
- [ ] 数据库查询无慢查询

### 安全验收

- [ ] 通过 OWASP Top 10 安全检查
- [ ] 敏感数据加密存储
- [ ] 无硬编码密钥泄露
- [ ] 访问日志完整记录

---

## 📚 参考资料

- [NextAuth.js 文档](https://authjs.dev/)
- [Prisma 文档](https://www.prisma.io/docs)
- [Vercel Cron Jobs](https://vercel.com/docs/cron-jobs)
- [React Query 文档](https://tanstack.com/query)

---

*文档维护: GEO Nexus 产品团队*  
*最后更新: 2026-01-26*
